# understand, open, and manipulate (GFS) grb2 files

GFS 4 grib2 data, _.grb2_ format.

[grb2 somewhat archaic format, but also widely used for meteorological (forecasting) data.](https://herbie.readthedocs.io/en/2023.12.2/user_guide/grib2.html)


use _xarray_ with _cfgrib_ back end.

```bash
pixi add xarray cfgrib
```

cfgrib package will also install *ls_grib* command line tool for describe .grb2 file contents e.g.

```bash
pixi run grib_ls -ptypeOfLevel,level,shortName ./gfs_4_20200101_0600_003.grb2

typeOfLevel  level        shortName    
...
isobaricInhPa  1000         t           
isobaricInhPa  1000         r           
isobaricInhPa  1000         tcc         
isobaricInhPa  1000         w           
isobaricInhPa  1000         wz          
isobaricInhPa  1000         u           
isobaricInhPa  1000         v           
isobaricInhPa  1000         absv        
isobaricInhPa  1000         clwmr       
isobaricInhPa  1000         icmr        
isobaricInhPa  1000         rwmr        
isobaricInhPa  1000         snmr        
isobaricInhPa  1000         grle        
isobaricInhPa  1000         ICSEV       
isobaricInhPa  1000         o3mr
isobaricInhPa  1000         gh  
...
```
[list of varname descriptions](https://www.nco.ncep.noaa.gov/pmb/docs/on388/table2.html)


open grb2 file in python, control cfgrib's behavior with backend_kwargs. cfgrib will write .idx files in same dir as grb2 files if grb_idx_path not specified. grb_index_path = '' will prevent any writing of .idx files (slower reads). Choose custom path if file permissions are a problem.
```python
level = 'isobaricInhPa'
var = 't'
grb_idx_path = ''
backend_kwargs = dict(
    filter_by_keys={'typeOfLevel': level, 'cfVarName': var},
    indexpath=grb_idx_path,
)
ds = xr.open_dataset(
  grib2_path_and_file, engine='cfgrib',
  backend_kwargs=backend_kwargs
)
```
Necessary to open each var separately, they have varying vertical scales even within the same typeOfLevel, [they don't make a perfect hypercube and cfgrib/xarray doesn't like that](https://github.com/ecmwf/cfgrib#filter-heterogeneous-grib-files).

you can open all valid datasets with:
```python
import cfgrib
cfgrib.open_datasets('gfs_4_20200101_0600_003.grb2')
```

[GFS 0.25ยบ global forecast historical archive](https://data.ucar.edu/dataset/ncep-gfs-0-25-degree-global-forecast-grids-historical-archive) [doi](https://doi.org/10.5065/D65D8PWK) [AWS bucket](https://noaa-gfs-bdp-pds.s3.amazonaws.com/index.html)

Consider preprocessing to different format if read speed is important. NB: grib2 is compressed, so other formats may take up a lot more disk space.







